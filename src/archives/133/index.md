---
title: マストドンがふっとんだ件
description: "マストドンがふっとんで5日ほど経ちました。まだ原因わかりません。頭の整理にいまわかってること書いていきます。実はデータ自体が消えたわけでも壊れたわけでもないです。原因がわかり、それを直せれば元の状態には戻るはずです。が、その原因がわからない。"
author: seroto_nin
type: post
date: 2017-06-10T14:40:06+00:00
url: /archives/133
categories:
  - マストドン

---
# {{this.$page.frontmatter.title}}

<Date/><CategoriesPerPost/>

{{this.$page.frontmatter.description}}

<!--more-->

## わかってること

- マストドンを1.4.1に上げ、それが要求するDocker-enginenを17.05、docker-composeを1.13.0に上げてから画像、css、データベースに格納されてるファイル(以下、これらのファイル)がマストドンコンテナからアクセスできなくなった
- これらのファイルはdockerコンテナ内ではなくホスト側のディレクトリに保存してあり、それをコンテナがマウントしている
- ホスト側から直で見るとファイルは残ってる
- ワードプレス側のディレクトリにこれらのファイルをコピーしてアクセスすれば正常に見れる
- コンテナ内部にログインして見てみると、ディレクトリのマウントは成功しており、中のデータも見れる
- Apache(リバプロとして利用)のログではこれらのファイルへのアクセスに200を返している(ただしbodyは空)
- マストドンのWebサーバコンテナのログを見ると、そもそもこれらのファイルへのアクセスが記録されていない

## つまり

何もわかってない。見れないファイルの種類から見て、ファイルアクセス権周りが今回のアプデで大幅に変更されていることが原因かと踏んでるんだけどちゃんと対応してるつもり。でもrubyのソースコードなんて読めないからわかんない。個人のブログ読むと静的コンテンツの配信元がコンテナからリバプロに変更されたみたいなこと書いてあるからそれが原因かもしれない。でもそんな大切なこと公式で言うはずだしこれが原因だとデータベースの中身が見れないのも説明できない。rubyのソースコード読めないからわかんない。Apacheじゃなくてnginxならいいのかもしれんけどnginxなんてわかんない。似たようなissueも上がってない。相談できる人もいない。再インスコもデグレもしてみたけど問題解決しない。特にデグレで問題解決しないのは本当に意味わかんない。gitの使い方間違ってるかもわかんない。

なーんかもやもやした嫌な気持ちを抱えたまま明日LPICの201受けてきます。
